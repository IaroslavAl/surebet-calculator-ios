# Project Lessons

Короткие инциденты и выводы. Этот файл не дублирует правила из других документов.

## 2026-02-01 — SwiftUI transition при закрытии онбординга
- Проблема: `.move(edge: .bottom)` терял анимацию или получал нежелательную opacity.
- Решение: базовый экран всегда в иерархии (например, `ZStack`), а transition/animation — только на слое онбординга.
- Урок: не анимировать весь контейнер, если нужен чистый move‑transition.

## 2026-01-27 — Race condition в MockURLProtocol
- Проблема: параллельные тесты перезаписывали глобальный handler и давали случайные сетевые ошибки.
- Решение: потокобезопасный реестр хендлеров по `URL.absoluteString`, регистрация по полному URL (с путём).
- Урок: тестовые URL должны быть уникальными и полностью совпадать с реальным запросом.

## 2026-01-27 — Sendable и SwiftLint
- Проблема: попытка отключить `sendable` предупреждения через SwiftLint и лишний `nonisolated(unsafe)` для `NSLock`.
- Решение: `sendable` — это предупреждение компилятора, а `NSLock` уже `Sendable`.
- Урок: не пытаться подавлять `sendable` через SwiftLint и проверять Sendable‑конформность типов.

## 2026-01-24 — SwiftUI accessibility identifiers в UI‑тестах
- Проблема: `accessibilityIdentifier` на кастомных кнопках не всегда доступен в XCUITest.
- Решение: использовать поиск по тексту кнопки или системной иконке.
- Урок: в UI‑тестах надёжнее `app.buttons["Button Text"]`, чем идентификаторы на кастомных labels.

## 2026-01-24 — UIDevice в nonisolated контексте
- Проблема: `UIDevice.current` требует MainActor в Swift 6.
- Решение: иметь отдельное `nonisolated(unsafe)` свойство с `MainActor.assumeIsolated`.
- Урок: UI‑зависимые свойства должны явно учитывать actor‑изоляцию.
