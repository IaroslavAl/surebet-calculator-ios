# INCIDENTS AND LESSONS

Формат записи:
- Дата
- Симптом
- Корневая причина
- Исправление
- Guardrail (правило на будущее)

## 2026-02-01 — Потеря transition при закрытии онбординга
- Симптом: `.move(edge: .bottom)` работал нестабильно.
- Корневая причина: анимировался контейнер, а не overlay-слой.
- Исправление: базовый экран всегда в иерархии, transition только на слое онбординга.
- Guardrail: не анимировать целый контейнер для локального перехода overlay.

## 2026-01-27 — Race condition в MockURLProtocol
- Симптом: флаки сетевых тестов.
- Корневая причина: глобальный handler перезаписывался параллельно.
- Исправление: потокобезопасный реестр по `URL.absoluteString`.
- Guardrail: уникальные полные URL и отсутствие shared глобального mutable handler.

## 2026-01-27 — Неверная стратегия подавления Sendable warning
- Симптом: попытка глушить `sendable` через SwiftLint.
- Корневая причина: warning компилятора Swift, не линтера.
- Исправление: корректная Sendable-конформность типов.
- Guardrail: сначала определять источник warning (compiler vs linter).

## 2026-01-24 — Нестабильность accessibilityIdentifier в UI-тестах
- Симптом: XCUITest не находил кастомные элементы.
- Корневая причина: идентификатор не всегда пробрасывался на нужный UI-элемент.
- Исправление: поиск по тексту кнопки/иконке.
- Guardrail: в UI-тестах выбирать самый стабильный локатор.

## 2026-01-24 — UIDevice в nonisolated контексте Swift 6
- Симптом: ошибка actor-изоляции.
- Корневая причина: `UIDevice.current` требует MainActor.
- Исправление: обертка с `nonisolated(unsafe)` и `MainActor.assumeIsolated`.
- Guardrail: явно документировать UI-зависимые nonisolated workaround.
